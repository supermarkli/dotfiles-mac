---
name: root-cause-tracing
description: æ ¹å› è¿½è¸ªï¼Œç”¨äºæ·±å±‚æ‰§è¡Œé”™è¯¯çš„å›æº¯åˆ†æã€‚æ¯” systematic-debugging æ›´æ·±å±‚ï¼Œä¸“æ³¨äºè°ƒç”¨æ ˆè¿½è¸ªã€‚
å½“é”™è¯¯å‘ç”Ÿåœ¨æ·±å±‚æ‰§è¡Œã€éœ€è¦è¿½æº¯åŸå§‹è§¦å‘ç‚¹æ—¶ä½¿ç”¨ã€‚
Use when errors occur deep in execution and you need to trace back to find the original trigger.
allowed-tools: "Bash,Read,Write,Grep,mcp__tavily__tavily-search"
---

# Root Cause Tracing - æ ¹å› è¿½è¸ª

æ·±å±‚æ‰§è¡Œé”™è¯¯çš„å›æº¯åˆ†æï¼Œé€šè¿‡è°ƒç”¨æ ˆè¿½è¸ªæ‰¾åˆ°åŸå§‹è§¦å‘ç‚¹ã€‚

## ğŸ¯ é€‚ç”¨èŒƒå›´

**ä½¿ç”¨æ­¤æŠ€èƒ½**ï¼š
- âœ… é”™è¯¯å‘ç”Ÿåœ¨æ·±å±‚è°ƒç”¨æ ˆ
- âœ… ç—‡çŠ¶ä¸åŸå› åˆ†ç¦»ï¼ˆå¦‚ï¼šå†…å­˜æ³„æ¼åœ¨ allocï¼Œå®é™…åœ¨ deleteï¼‰
- âœ… éœ€è¦è¿½æº¯é”™è¯¯ä¼ æ’­è·¯å¾„
- âœ… systematic-debugging æ— æ³•å®šä½

**ä¸ systematic-debugging çš„åŒºåˆ«**ï¼š

| | systematic-debugging | root-cause-tracing |
|---|:---|:---|
| **æ–¹æ³•** | äº”æ­¥æ³•ï¼ˆå®šä¹‰â†’éš”ç¦»â†’å‡è®¾â†’éªŒè¯â†’ä¿®å¤ï¼‰| è°ƒç”¨æ ˆå›æº¯ |
| **é€‚ç”¨** | é€»è¾‘é—®é¢˜ã€å¤æ‚ bug | æ·±å±‚æ‰§è¡Œé”™è¯¯ |
| **è¾“å‡º** | æ ¹å›  + ä¿®å¤æ–¹æ¡ˆ | å®Œæ•´è°ƒç”¨é“¾ + è§¦å‘ç‚¹ |

---

## ğŸ” å›æº¯è¿½è¸ªæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é”™è¯¯ç—‡çŠ¶                            â”‚
â”‚            "Segmentation fault at line 500"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è·å–å®Œæ•´è°ƒç”¨æ ˆ (Backtrace)                 â”‚
â”‚    #0  function_c () at crash.c:500                    â”‚
â”‚    #1  function_b () at util.c:120                    â”‚
â”‚    #2  function_a () at main.c:50                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è¿½è¸ªæ•°æ®æµ                            â”‚
â”‚    æ£€æŸ¥æ¯å±‚å‚æ•°ã€è¿”å›å€¼ã€çŠ¶æ€å˜æ›´                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å®šä½è§¦å‘ç‚¹                            â”‚
â”‚    æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¼‚å¸¸çŠ¶æ€/é”™è¯¯çš„èµ·æº                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   éªŒè¯æ ¹å›                               â”‚
â”‚    ä¿®å¤è§¦å‘ç‚¹ï¼Œç¡®è®¤ç—‡çŠ¶æ¶ˆå¤±                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬ä¸€æ­¥ï¼šè·å–å®Œæ•´è°ƒç”¨æ ˆ

### Python

```python
# æ·»åŠ åˆ°å¼‚å¸¸å¤„ç†
import traceback

try:
    risky_operation()
except Exception as e:
    print("Full traceback:")
    traceback.print_exc()
    # æˆ–å†™å…¥æ–‡ä»¶
    with open('/tmp/traceback.txt', 'w') as f:
        traceback.print_exc(file=f)
```

### JavaScript/Node.js

```javascript
// æ•è·å®Œæ•´å †æ ˆ
try {
    riskyOperation();
} catch (error) {
    console.error(error.stack);

    // æˆ–ä½¿ç”¨ Error.stackTraceLimit
    Error.stackTraceLimit = 50;
}
```

### Bash è„šæœ¬

```bash
# åœ¨è„šæœ¬ä¸­æ·»åŠ è°ƒè¯•
set -x  # æ‰“å°æ‰§è¡Œçš„å‘½ä»¤
set -e  # é‡åˆ°é”™è¯¯é€€å‡º

# æˆ–ä½¿ç”¨ bashdb
bashdb script.sh
```

---

## ç¬¬äºŒæ­¥ï¼šåˆ†æè°ƒç”¨æ ˆ

### è°ƒç”¨æ ˆè§£è¯»æ¨¡æ¿

```
Frame #0: function_c at crash.c:500
â”œâ”€â”€ è¿™æ˜¯å´©æºƒç‚¹ï¼ˆç—‡çŠ¶ï¼‰
â”œâ”€â”€ æ£€æŸ¥ï¼šå‚æ•°å€¼ã€å±€éƒ¨å˜é‡ã€çŠ¶æ€
â””â”€â”€ é—®é¢˜ï¼šNULL pointer dereference?

Frame #1: function_b at util.c:120
â”œâ”€â”€ è°ƒç”¨ function_c çš„ä½ç½®
â”œâ”€â”€ æ£€æŸ¥ï¼šä¼ é€’ç»™ function_c çš„å‚æ•°
â””â”€â”€ é—®é¢˜ï¼šä¼ é€’äº† NULL?

Frame #2: function_a at main.c:50
â”œâ”€â”€ æ›´ä¸Šå±‚çš„è°ƒç”¨
â”œâ”€â”€ æ£€æŸ¥ï¼šæ•°æ®æ¥æº
â””â”€â”€ é—®é¢˜ï¼šæ•°æ®åˆå§‹åŒ–é”™è¯¯?
```

### æ•°æ®æµè¿½è¸ª

```python
# åœ¨æ¯ä¸€å±‚æ·»åŠ æ—¥å¿—
def function_a(data):
    logger.info("[A] Input: %s", data)  # â† æ£€æŸ¥è¾“å…¥
    processed = function_b(data)
    return processed

def function_b(data):
    logger.info("[B] Processing: %s", data)  # â† æ£€æŸ¥ä¸­é—´çŠ¶æ€
    result = function_c(data)
    return result

def function_c(data):
    logger.info("[C] Final: %s", data)  # â† æ£€æŸ¥æœ€ç»ˆçŠ¶æ€
    # å´©æºƒå‘ç”Ÿåœ¨è¿™é‡Œ
```

---

## ç¬¬ä¸‰æ­¥ï¼šå®šä½è§¦å‘ç‚¹

### å¸¸è§æ ¹å› æ¨¡å¼

#### æ¨¡å¼ 1ï¼šçŠ¶æ€æ±¡æŸ“

```
æ—¶åˆ» T0: obj.data = "valid"
æ—¶åˆ» T1: obj.data = null  â† è§¦å‘ç‚¹
æ—¶åˆ» T2: use(obj.data)    â† å´©æºƒ
```

**å®šä½**ï¼šè¿½è¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

```python
# æ·»åŠ ç”Ÿå‘½å‘¨æœŸè¿½è¸ª
class DataObject:
    def __init__(self):
        self.history = []  # è¿½è¸ªæ‰€æœ‰å˜æ›´

    def set_data(self, value):
        self.history.append(('set', value, traceback.extract_stack()))
        self.data = value
```

#### æ¨¡å¼ 2ï¼šå¼‚æ­¥ç«äº‰

```
çº¿ç¨‹ A: write(data)
çº¿ç¨‹ B: free(data)     â† è§¦å‘ç‚¹
çº¿ç¨‹ A: read(data)     â† å´©æºƒ
```

**å®šä½**ï¼šæ·»åŠ çº¿ç¨‹å®‰å…¨æ£€æŸ¥

```python
import threading

class SafeObject:
    def __init__(self):
        self.lock = threading.Lock()
        self.data = None

    def read(self):
        with self.lock:
            # æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
            if self.data is None:
                raise ValueError("Data was freed!")
            return self.data
```

#### æ¨¡å¼ 3ï¼šå»¶è¿Ÿåˆå§‹åŒ–å¤±è´¥

```
å¯åŠ¨: lazy_obj = None    â† è§¦å‘ç‚¹ï¼šæœªåˆå§‹åŒ–
ä½¿ç”¨: lazy_obj.method()  â† å´©æºƒ
```

**å®šä½**ï¼šæ£€æŸ¥åˆå§‹åŒ–è·¯å¾„

```python
# æ·»åŠ åˆå§‹åŒ–æ–­è¨€
class LazyObject:
    def __init__(self):
        self._initialized = False

    def method(self):
        assert self._initialized, "Call init() first!"
        # ...
```

---

## ç¬¬å››æ­¥ï¼šéªŒè¯æ ¹å› 

### æœ€å°å¤ç°ç”¨ä¾‹

```python
# æå–è§¦å‘è·¯å¾„
def reproduce_bug():
    # åªä¿ç•™è§¦å‘è·¯å¾„ä¸Šçš„ä»£ç 
    data = create_problematic_state()  # â† è§¦å‘ç‚¹
    result = crash_function(data)      # â† å´©æºƒ
    return result

# å¦‚æœèƒ½å¤ç°ï¼Œæ ¹å› å®šä½æ­£ç¡®
reproduce_bug()
```

### ä¿®å¤éªŒè¯

```bash
# 1. ä¿®å¤è§¦å‘ç‚¹
# 2. è¿è¡Œå¤ç°ç”¨ä¾‹
python reproduce_bug.py

# 3. ç¡®è®¤ä¸å†å´©æºƒ
# 4. æ·»åŠ å›å½’æµ‹è¯•
```

---

## å·¥å…·å‚è€ƒ

### è°ƒè¯•å·¥å…·

```bash
# GDB (C/C++)
gdb --args ./program
(gdb) run
(gdb) bt        # backtrace
(gdb) frame 0   # åˆ‡æ¢åˆ° frame 0
(gdb) print var # æ‰“å°å˜é‡

# LLDB (C/C++/Swift)
lldb ./program
(lldb) bt
(lldb) frame select 0
(lldb) var var

# Python pdb
python -m pdb script.py
(p) where      # å †æ ˆ
(p) up         # ä¸Šä¸€å¸§
(p) down       # ä¸‹ä¸€å¸§
(p) p var      # æ‰“å°å˜é‡

# Node.js inspector
node --inspect script.js
# åœ¨ Chrome DevTools ä¸­è°ƒè¯•
```

### å†…å­˜è°ƒè¯•

```bash
# Valgrind (å†…å­˜æ³„æ¼)
valgrind --leak-check=full --show-leak-kinds=all ./program

# AddressSanitizer (clang/gcc)
cc -fsanitize=address -g script.c
./a.out
```

---

## ä¸ systematic-debugging é…åˆ

```
é‡åˆ° bug
  â†“
systematic-debugging äº”æ­¥æ³•
  â†“
æ‰¾åˆ°å¯ç–‘åŒºåŸŸä½†æ ¹å› ä¸æ˜ï¼Ÿ
  â†“
root-cause-tracing å›æº¯è°ƒç”¨æ ˆ
  â†“
å®šä½è§¦å‘ç‚¹
  â†“
è¿”å› systematic-debugging éªŒè¯ä¿®å¤
```

---

## å¸¸è§è§¦å‘åœºæ™¯

ä½¿ç”¨æ­¤æŠ€èƒ½æ—¶ï¼Œä½ ä¼šå¬åˆ°ï¼š
- "æ·±å±‚è°ƒç”¨æ ˆé”™è¯¯"
- "è°ƒç”¨é“¾å¾ˆé•¿ï¼Œæ‰¾ä¸åˆ°å“ªé‡Œå‡ºé”™"
- "ç—‡çŠ¶ä¸åŸå› åˆ†ç¦»"
- "segmentation fault"
- "trace back"
- "root cause tracing"
- "deep stack trace"
